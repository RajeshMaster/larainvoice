DROP FUNCTION IF EXISTS FnGetAmountIncTax;
DELIMITER $$
CREATE DEFINER = CURRENT_USER FUNCTION `FnGetAmountIncTax`(`QUOTE_DATE` date,`TAX` bigint,`AMT` BIGINT) RETURNS bigint(50)
BEGIN
 DECLARE AMTINCTAX DECIMAL(50,2);
 DECLARE TAXAMT BIGINT;
	#Routine body goes here...
	-- SET AMTINCTAX = 
	
		SELECT
			dtd.Tax INTO TAXAMT
		FROM dev_taxdetails dtd
		WHERE delflg = 0 AND Startdate <= QUOTE_DATE
		ORDER BY Startdate DESC, Ins_TM DESC
		LIMIT 1;

		IF(TAX != 2)
		THEN SET AMTINCTAX = AMT + (TAXAMT/100);
		ELSE SET AMTINCTAX = AMT;
		END IF;
		-- (AMT + (CASE WHEN TAX != 2 THEN TBL.Tax/100 ELSE 0 END)) INTO AMTINCTAX
	-- SIGNAL SQLSTATE 'EMPID' SET MESSAGE_TEXT = AMTINCTAX;
	RETURN AMTINCTAX;
END